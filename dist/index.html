<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Egg Interpreter</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="./assets/css/0.styles.f1456810.css" as="style"><link rel="preload" href="./assets/js/app.64c68616.js" as="script"><link rel="preload" href="./assets/js/2.2c19e274.js" as="script"><link rel="preload" href="./assets/js/7.174b8db1.js" as="script"><link rel="prefetch" href="./assets/js/3.79b60fea.js"><link rel="prefetch" href="./assets/js/4.0d8f90e9.js"><link rel="prefetch" href="./assets/js/5.5f81c412.js"><link rel="prefetch" href="./assets/js/6.2f3f3a69.js">
    <link rel="stylesheet" href="./assets/css/0.styles.f1456810.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="./" aria-current="page" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">Egg Interpreter</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="./docs-jsdoc/index.html" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="./lcov-report/index.html" class="nav-link">
  Coverage
</a></div><div class="nav-item"><a href="https://github.com/ULL-ESIT-PL-2122/egg-interpreter-sebastian-tamayo-guzman-alu0101131108/packages/1392062" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Module
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ULL-ESIT-PL-2122/egg-interpreter-sebastian-tamayo-guzman-alu0101131108.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="./docs-jsdoc/index.html" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="./lcov-report/index.html" class="nav-link">
  Coverage
</a></div><div class="nav-item"><a href="https://github.com/ULL-ESIT-PL-2122/egg-interpreter-sebastian-tamayo-guzman-alu0101131108/packages/1392062" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Module
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ULL-ESIT-PL-2122/egg-interpreter-sebastian-tamayo-guzman-alu0101131108.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main aria-labelledby="main-title" class="home"><header class="hero"><!----> <h1 id="main-title">
      Egg Interpreter
    </h1> <p class="description">
      Welcome to your VuePress site
    </p> <!----></header> <!----> <div class="theme-default-content custom content__default"><h2 id="modificacion-del-modulo-egg-parser"><a href="#modificacion-del-modulo-egg-parser" class="header-anchor">#</a> Modificación del Módulo Egg-Parser</h2> <p>En primer lugar se ha modificado el módulo Egg-Parser creado en prácticas anteriores. La modificación consiste
en que ahora hace uso del módulo Lexer-Generator para generar un analizador léxico capaz de analizar código de Egg.</p> <p>Se puede observar en el siguiente código que se incluye la función nearleyLexer del módulo Lexer-Generator. Esta función
recibe una lista de tokens, que consisten principalmente en las expresiones regulares que se aceptarán. El analizador
léxico que genera está pensado para que sea compatible con Nearley.js.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> nearleyLexer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@ull-esit-pl-2122/lexer-generator-sebastian-tamayo-guzman-alu0101131108&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">WHITES</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;WHITES&gt;[\s]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token constant">WHITES</span><span class="token punctuation">.</span>skip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token constant">WHITES</span><span class="token punctuation">.</span>lineBreaks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">HASHTAG</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;HASHTAG&gt;#[^\n]*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token constant">HASHTAG</span><span class="token punctuation">.</span>skip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ML_COMMENT</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;ML_COMMENT&gt;\/\*[^]*?\*\/)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token constant">ML_COMMENT</span><span class="token punctuation">.</span>skip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SL_COMMENT</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;SL_COMMENT&gt;\/\/.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token constant">SL_COMMENT</span><span class="token punctuation">.</span>skip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">NUMBER</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;NUMBER&gt;[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token constant">NUMBER</span><span class="token punctuation">.</span><span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">STRING</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;STRING&gt;&quot;(?:[^&quot;\\]|\\.)*&quot;)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">WORD</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;WORD&gt;[^\s(),&quot;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">LEFTP</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;LP&gt;\()</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RIGHTP</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;RP&gt;\))</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COMMA</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;COMMA&gt;,)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">WHITES</span><span class="token punctuation">,</span> <span class="token constant">HASHTAG</span><span class="token punctuation">,</span> <span class="token constant">ML_COMMENT</span><span class="token punctuation">,</span> <span class="token constant">SL_COMMENT</span><span class="token punctuation">,</span> <span class="token constant">NUMBER</span><span class="token punctuation">,</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">WORD</span><span class="token punctuation">,</span> <span class="token constant">LEFTP</span><span class="token punctuation">,</span> <span class="token constant">RIGHTP</span><span class="token punctuation">,</span> <span class="token constant">COMMA</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> lexer <span class="token operator">=</span> <span class="token function">nearleyLexer</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lexer<span class="token punctuation">;</span>
</code></pre></div><p>Se añade además un archivo parse.js que contendrá la lógica asociada a las tareas de parseado de manera conjunta.
Para ello incluye la función parse(), que recibe un código en Egg y se encarga de construir un Parser del módulo Nearley,
utilizando la gramática construida previamente haciendo uso del analizador léxico y de un archivo egg.ne. A continuación,
parsea el código de entrada y genera un AST de nodos JSON, con los atributos de los tokens encontrados, que es devuelto
como resultado.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nearley <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;nearley&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> grammar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./src/grammar.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">parse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> astJson<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">nearley<span class="token punctuation">.</span>Parser</span><span class="token punctuation">(</span>nearley<span class="token punctuation">.</span>Grammar<span class="token punctuation">.</span><span class="token function">fromCompiled</span><span class="token punctuation">(</span>grammar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parser<span class="token punctuation">.</span><span class="token function">feed</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    astJson <span class="token operator">=</span> parser<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log( JSON.stringify(ast, null, 2) );</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> astJson<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Similar a parse(), se incluyen en los exports una función que realiza el mismo proceso pero
leyendo el código de entrada de un archivo. También incluye una función parBalance(line) que
analiza una cadena de texto asociada a un código en Egg y devuelve un entero asociado con la
coherencia de los paréntesis. Por último, se incluye también getTokens(), una función perteneciente
al analizador léxico, para poder obtener la lista de tokens reconocidos a partir de una cadena
de texto.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> getTokens <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lex.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lexer<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">parBalance</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token function">getTokens</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> token <span class="token keyword">of</span> tokens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'LP'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'RP'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> stack<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="implementacion-del-modulo-egg-interpreter"><a href="#implementacion-del-modulo-egg-interpreter" class="header-anchor">#</a> Implementación del Módulo Egg-Interpreter</h2> <h3 id="utils-colors-extensions-y-registry"><a href="#utils-colors-extensions-y-registry" class="header-anchor">#</a> Utils, Colors, Extensions y Registry</h3> <p>Estos cuatro archivos los proporciona el profesor ya desarrollados Contienen funcionalidades varias para enriquezer
el resultado de la práctica. Conviene mencionar el archivo registry.js, pues en el se crean dos objetos que no heredan
su prototipo de la clase Object y serán muy importantes en los siguientes archivos.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> specialForms <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> topEnv <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ast-y-j2a"><a href="#ast-y-j2a" class="header-anchor">#</a> Ast y J2A</h3> <p>El archivo ast.js contiene tres clases que pueden asociarse a cada tipo de nodo en un árbol de análisis sintáctico de un
programa Egg. Estas tres clases son Value, con atributos type y value; Word, con atributos type y name; y Apply, con atributos
type, operator y args. Además, cada una de ellas tiene uno o varios métodos para evaluar su propio resultado.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> token<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> token<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Word</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> token<span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">'word'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> token<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token keyword">in</span> env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> env<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Undefined variable: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">leftEvaluate</span><span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> scope <span class="token operator">=</span> env<span class="token punctuation">;</span> scope<span class="token punctuation">;</span> scope <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tried setting an undefined variable: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Apply</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">tree</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> tree<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>operator <span class="token operator">=</span> tree<span class="token punctuation">.</span>operator<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>args <span class="token operator">=</span> tree<span class="token punctuation">.</span>args<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'word'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name <span class="token keyword">in</span> specialForms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> specialForms<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> op <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> argsProcessed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> op <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token operator">...</span>argsProcessed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Applying not a function or method '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Cada una de estas clases es construible partiendo de un nodo en formato JSON. Se pretende que se construyan a partir del AST
de nodos JSON generado por la función parse() previamente descrita. Esta tarea se encuentra en el archivo j2a.js, en la función
json2AST. Se encarga de recorrer recursivamente un AST de nodos json e ir generando un AST que tiene objetos de las clases descritas
anteriormente.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> j2a <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
j2a<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Value</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
j2a<span class="token punctuation">[</span><span class="token string">'word'</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Word</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
j2a<span class="token punctuation">[</span><span class="token string">'apply'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Apply</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">json2AST</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'apply'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Apply</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'apply'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token function">json2AST</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>operator<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">args</span><span class="token operator">:</span> node<span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">tree</span> <span class="token operator">=&gt;</span> <span class="token function">json2AST</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> j2a<span class="token punctuation">[</span>node<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="egg-interpreter"><a href="#egg-interpreter" class="header-anchor">#</a> Egg-interpreter</h3> <p>En este archivo se incluyen muchos valores dentro de los HashMaps specialForms y topEnv creados previamente en el archivo
Registry.js. En specialForms se incluyen varias funciones que serán necesarias durante la evaluación de los nodos, ya que
estarán asociadas a sentencias como def, set o if, y además estarán encargadas de continuar el proceso de evaluación de
sus nodos hijos. Por ejemplo, la función asociada al operador if, comprueba tener 3 argumentos, y retorna la evaluación del
segundo o tercer argumento según el resultado la evaluación del primer argumento.</p> <div class="language-js extra-class"><pre class="language-js"><code>specialForms<span class="token punctuation">[</span><span class="token string">'if'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">'Bad number of args to if'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>El HashMap topEnv actuará como la memoria de más alto nivel del programa. De hecho, será el objeto del cual heredarán su
prototipo el resto de ámbitos de memoria del programa, directa o indirectamente. En el se incluyen inicialmente una serie
de primitivas con la finalidad de añadir más funcionalidades al programa.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// (...)</span>
topEnv<span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
topEnv<span class="token punctuation">[</span><span class="token string">'true'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
topEnv<span class="token punctuation">[</span><span class="token string">'false'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
topEnv<span class="token punctuation">[</span><span class="token string">'undefined'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
topEnv<span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
topEnv<span class="token punctuation">[</span><span class="token string">'Math'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">;</span>

<span class="token keyword">const</span> operators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'**'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&lt;='</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&gt;='</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
operators<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">op</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  topEnv<span class="token punctuation">[</span>op<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'a, b'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>op<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> b;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `return s.reduce((a,b) =&gt; a ${op} b);`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para concluir con el interpreter, se desarrollan tres funciones. La principal es run(program), se encarga de
parsear el código Egg que recibe en una cadena de texto por parámetro, generando un AST de nodos JSON. Luego
traduce este AST JSON a un AST que tiene objetos de las clases de ast.js como nodos. A continuación, inicia la
cadena de ejecución de las funciones evaluate de los nodos del arbol empezando por la raíz. La función devuelve
el valor computado de la evaluación del nuevo AST.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">program</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tree <span class="token operator">=</span> <span class="token function">json2AST</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> env <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>topEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Last funciones runFromFile(filepath) y runFromEvm(filepath) son otras funciones similares que exporta este archivo.
La primera es igual a run, salvo que el código Egg de entrada está contenido en un archivo, y la segunda lee de un
archivo la especificación de un AST de nodos JSON, y a raíz de el evalua su resultado.</p> <h3 id="egg-repl"><a href="#egg-repl" class="header-anchor">#</a> Egg-repl</h3> <p>Este archivo contiene una función eggRepl() que inicia un Read-Evaluate-Print-Loop de código Egg.
Para ello hace uso principalmente del intérprete que creamos anteriormente y del módulo readline,
que provee de una interfaz para leer datos desde un stream como la consola, de linea en linea.</p> <p>La función tiene que hacer un seguimiento del programa, manteniendo el recuento de paréntesis
abiertos y cerrados.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> program <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><p>Cabe destacar que se utiliza una estructura de try...catch para capturar errores que pueda generar
la entrada del usuario e imprimirlos de manera amigable y colorida en la consola.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token comment">/* (...) */</span><span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A continuación, se debe inicializa la interfaz del módulo readline y se especifica un comportamiento inicial. Esto
es la impresión por consola de una especie de cabecera en la que se muestra la versión del módulo y un símbolo que
indica al usuario donde está ingresando texto.</p> <p>A continuación, se especifica su comportamiento frente a una serie de eventos, se omite del siguiente codigo con fines de claridad.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span> <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> completer<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rl<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token constant">PROMPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Version '</span> <span class="token operator">+</span> topEnv<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rl<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// rl.on(event) {...}</span>

process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> eggExit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El evento principal al que se debe reaccionar es ante una entrada de input del usuario. Para ello se define
un trigger para el evento line. Este consiste en actualizar los valores de program y stack, para luego generar
un nuevo AST que se evalúa y escribe su resultado. Cualquier error será formateado además para mostrarlo de manera
amigable y colorida.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// End of user input line event</span>
rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stack <span class="token operator">+=</span> <span class="token function">parBalance</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

  line <span class="token operator">=</span> line <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  program <span class="token operator">+=</span> line<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>stack <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">ALLWHITE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">json2AST</span><span class="token punctuation">(</span><span class="token function">parse</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>topEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">ins</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    program <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    stack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  rl<span class="token punctuation">.</span><span class="token function">setPrompt</span><span class="token punctuation">(</span><span class="token constant">PROMPT</span> <span class="token operator">+</span> <span class="token string">'..'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rl<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aparte, también se establecen triggers para los eventos de CTRL+D y CTRL+C. El primero termina el bucle lanzando
un mensaje de despedida, y el segundo descarta la expresión actual.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Close REPL event (CTRL + D)</span>
rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> eggExit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Discard REPL event (CTRL + C)</span>
rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'Expression discarded!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  program <span class="token operator">=</span> <span class="token string">';'</span><span class="token punctuation">;</span>
  stack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  rl<span class="token punctuation">.</span><span class="token function">setPrompt</span><span class="token punctuation">(</span><span class="token constant">PROMPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rl<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="executables"><a href="#executables" class="header-anchor">#</a> Executables</h2> <p>This module includes two main executables to interpret Egg logic.</p> <ul><li>egg (bin/egg.js): Accepts a filepath as parameter, expecting some egg code inside the file. Then it returns the result of the code. If no parameter is provided, an Egg REPL will initiate.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> runFromFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/egg-interpreter.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> eggRepl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/egg-repl.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fileName <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">&amp;&amp;</span> fileName<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">runFromFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">eggRepl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>evm (bin/evm.js): One argument is expected, a filepath to a file containing the JSON representation of an AST of Egg code. Then it returns the result of the code associated to that JSON AST.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token punctuation">{</span> runFromEVM <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/egg-interpreter.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fileName <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">&amp;&amp;</span> fileName<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">runFromEVM</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tests"><a href="#tests" class="header-anchor">#</a> Tests</h2> <p>Se siguió unos archivos y una estructura determinada para los tests definida por el profesor. Todo se encuentra en la carpeta test,
dentro de la cual está la carpeta examples que contiene una serie de parejas de archivos .egg y .egg.expected, que contienen códigos
egg y sus resultados respectivamente.</p> <div class="language- extra-class"><pre class="language-text"><code># array.egg
do (
  def(x, arr(arr(1, 4), 5, 7)),
  print([](x, 0)),
  print([](x, 1))
)
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code># array.egg.expected
[1,4]
5
</code></pre></div><p>Entonces la ejecución de los test se basa en comprobar que al utilizar el interpretador para un archivo .egg de examples, se genere
el mismo resultado que se encuentra en el archivo .egg.expected asociado.</p> <p>Se incluyeron 5 archivos .spec.js para comprobar arrays, asignaciones, ifs, scopes y strings. Y el resultado de ejecutar el comando
npm test es el siguiente.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>usuario@ubuntu ~/Egg-Interpreter <span class="token punctuation">(</span>master<span class="token punctuation">)</span> $ <span class="token function">npm</span> <span class="token builtin class-name">test</span>

<span class="token operator">&gt;</span> @ull-esit-pl-2122/egg-interpreter-sebastian-tamayo-guzman-alu0101131108@1.0.1 <span class="token builtin class-name">test</span>
<span class="token operator">&gt;</span> nyc --reporter<span class="token operator">=</span>lcov --reporter<span class="token operator">=</span>text-summary --report-dir<span class="token operator">=</span>docs/coverage -o docs mocha



  Testing arrays
    ✔ testing array.egg <span class="token punctuation">(</span>924ms<span class="token punctuation">)</span>
    ✔ testing array-negative-index.egg <span class="token punctuation">(</span>959ms<span class="token punctuation">)</span>

  Testing set: Assigments
    ✔ testing one.egg <span class="token punctuation">(</span>903ms<span class="token punctuation">)</span>
    ✔ testing set-error.egg <span class="token punctuation">(</span>875ms<span class="token punctuation">)</span>

  Testing <span class="token keyword">if</span> sentence
    ✔ testing if.egg <span class="token punctuation">(</span>878ms<span class="token punctuation">)</span>

  Testing scopes
    ✔ should  not allow the use of non declared variables
    ✔ testing scope.egg <span class="token punctuation">(</span>882ms<span class="token punctuation">)</span>

  Testing strings
    ✔ testing string.egg <span class="token punctuation">(</span>1003ms<span class="token punctuation">)</span>


  <span class="token number">8</span> passing <span class="token punctuation">(</span>6s<span class="token punctuation">)</span>


<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Coverage summary <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Statements   <span class="token builtin class-name">:</span> <span class="token number">67.35</span>% <span class="token punctuation">(</span> <span class="token number">163</span>/242 <span class="token punctuation">)</span>
Branches     <span class="token builtin class-name">:</span> <span class="token number">60.93</span>% <span class="token punctuation">(</span> <span class="token number">39</span>/64 <span class="token punctuation">)</span>
Functions    <span class="token builtin class-name">:</span> <span class="token number">60</span>% <span class="token punctuation">(</span> <span class="token number">27</span>/45 <span class="token punctuation">)</span>
Lines        <span class="token builtin class-name">:</span> <span class="token number">69.46</span>% <span class="token punctuation">(</span> <span class="token number">157</span>/226 <span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre></div></div> <div class="footer">
    Made with ❤️
  </div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.64c68616.js" defer></script><script src="/assets/js/2.2c19e274.js" defer></script><script src="/assets/js/7.174b8db1.js" defer></script>
  </body>
</html>
